<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

	


<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<title>侦测程序句柄泄露的统计方法</title>
<link rel="schema.DC" href="http://purl.org/DC/elements/1.0/"/>
<link rel="SHORTCUT ICON" href="//www.ibm.com/favicon.ico"/>
<meta name="DC.Rights" content="© Copyright IBM Corporation 2009"/>
<meta name="Keywords" content="句柄 , 泄露 , 统计, tttlca"/>
<meta name="DC.Date" scheme="iso8601" content="2009-11-05"/>
<meta name="Source"  content="v17 delivery:developerWorks"/>
<meta name="Security" content="Public"/>
<meta name="Abstract" content="在 Linux 平台上运行的进程都会从系统资源申请一定数量的句柄，而且系统控制了进程能够申请的最大句柄数量。用户程序如果不及时释放无用的句柄，将会引起句柄泄露，从而可能造成申请资源失败。该文章从 linux 内核角度分析了句柄的产生和泄漏的原因，并采用一种应用统计侦测句柄的方法，为用户判断程序句柄是否泄漏提供了更直观的依据。"/>
<meta name="Description" content="在 Linux 平台上运行的进程都会从系统资源申请一定数量的句柄，而且系统控制了进程能够申请的最大句柄数量。用户程序如果不及时释放无用的句柄，将会引起句柄泄露，从而可能造成申请资源失败。该文章从 linux 内核角度分析了句柄的产生和泄漏的原因，并采用一种应用统计侦测句柄的方法，为用户判断程序句柄是否泄漏提供了更直观的依据。"/>
<meta name="IBM.Effective" scheme="W3CDTF" content="2009-11-05"/>
<meta name="Owner" content="developerWorks/China/IBM"/>
<meta name="DC.Language" scheme="rfc1766" content="zh-CN"/>
<meta name="IBM.SpecialPurpose" content="SP001"/>
<meta name="IBM.Country" content="CN"/>
<meta name="Robots" content="index,follow"/>
<meta name="DC.Type" scheme="IBM_ContentClassTaxonomy" content="CT316" />
<meta name="DC.Subject" scheme="IBM_SubjectTaxonomy" content="SWGC0" />
<meta name="dW.ContentArea" content="2" />
<meta name="dW.Topic" content="553" />

<meta scheme="IBM_WTMCategory" name="IBM.WTMCategory" content="SOFDCLNXCN" />

	<link rel="canonical" href="http://www.ibm.com/developerworks/cn/linux/l-cn-handle/index.html"/>
<!-- HEADER_SCRIPTS_AND_CSS_INCLUDE -->
<link href="//1.www.s81c.com/common/v17/css/www.css" rel="stylesheet" title="www"  type="text/css"/>
<link href="//1.www.s81c.com/common/v17/css/country/cnzh.css" rel="stylesheet" title="www" type="text/css">
<!-- Masthead/footer -->
<link href="//dw1.s81c.com/developerworks/css/dw-mf/v17/dw-mfN2014-05.css" media="screen,projection" rel="stylesheet" title="www" type="text/css"/>
<link href="//dw1.s81c.com/developerworks/css/v17/dw-article-6.css" rel="stylesheet" title="www" type="text/css"/>
<link href="//dw1.s81c.com/developerworks/css/v17/dw-common-features.css" rel="stylesheet" title="www" type="text/css"/>
<link href="//dw1.s81c.com/developerworks/css/v17/dw-local-site-v17-N2014-05.css" media="screen,projection" rel="stylesheet" title="www" type="text/css"/>
<script type="text/javascript" src="//1.www.s81c.com/common/js/dojo/www.js">//</script>
<script type="text/javascript" src="//dw1.s81c.com/developerworks/js/v17/dw-www.js">//</script>
<script type="text/javascript">
//  ibmweb.config.set({ sbs: { enabled: false }});
</script>
<!-- A/B Exp -->
<script type="text/javascript"> 
    dojo.addOnLoad(function(){
                        var dw_source = "dwchina";
                var dw_tile_alt = "在 IBM Bluemix 云平台上开发并部署您的下一个应用。现在就开始免费试用";
                var dw_register = "注册免费的 Bluemix 试用版";
                var dw_connect = "连接 Bluemix 开发者";     				
        var dw_campaign = "bluemix";
        var dw_content = window.location.pathname.split("/")[window.location.pathname.split("/").length-2];
        if (dw_content == "library") {
            dw_content = window.location.pathname.split("/")[window.location.pathname.split("/").length-3] + "-" + window.location.pathname.split("/")[window.location.pathname.split("/").length-1];
            dw_content = dw_content.substring(0,dw_content.indexOf(".html"));
        }
        var dw_medium = "article";     
        var artTop = dojo.query("div.ibm-col-1-1")[0];
        var artChildren = dojo.query(artTop).children();
		var bluLink = "https://www.bluemix.net/?cm_mmc=" + dw_source + "-_-" + dw_campaign + "-_-" + dw_content + "-_-" + dw_medium;  
        var edgy = false;
        if (dojo.hasClass(artChildren[0], "ibm-inset")) edgy = true;
        if ((artChildren[0].nodeName == "H2") && (dojo.hasClass(artChildren[1], "ibm-inset"))) edgy = true;                
        if (dojo.hasClass(artChildren[0], "codesection")) edgy = true; 
        if ((artChildren[0].nodeName == "H5") && (dojo.hasClass(artChildren[1], "codesection"))) edgy = true;
        if ((artChildren[0].nodeName == "H5") && (artChildren[1].width >= 701)) edgy = true;
        if (artChildren[1].width >= 701) edgy = true;
        if (dojo.hasClass(artChildren[0], "ibm-data-table")) edgy = true; 
        if ((artChildren[0].nodeName == "H5") && (dojo.hasClass(artChildren[1], "ibm-data-table"))) edgy = true;
        if (!(edgy)) { 
            var	sBarAB = '<div style="float:right;clear:none;margin:0 0 6px 16px;" id="dwc-exp-d">' +
                '<a href="'+ bluLink +'">' +
                '<img width="224" height="194" alt="' + dw_tile_alt + '" src="//dw1.s81c.com/developerworks/i/bluemixad224x194-b.png"/>' +
                '</a></div>';        
            var col61 = dojo.query ("#ibm-content-main .ibm-col-1-1")[0];                
            dojo.place(sBarAB, col61, "first");    
        }
        dojo.forEach(dojo.query ("p.ibm-button-link-alternate a"), function (item, index) {
            var gcLink = dojo.attr(item, "href");
            if ((gcLink.indexOf("//hub.jazz.net/git") > -1) || (gcLink.indexOf("//hub.jazz.net/project") > -1)) {
                if (gcLink.indexOf("?") == -1) {
                    gcLink = "https://login.jazz.net/psso/proxy/jazzregister?utm_source=" + dw_source + "&utm_medium=" + dw_medium + "&utm_content=" + dw_content + "&utm_campaign=" + dw_campaign + "&redirect_uri=" + gcLink;
                } else {
                    gcLink = "https://login.jazz.net/psso/proxy/jazzregister?utm_source=" + dw_source + "&utm_medium=" + dw_medium + "&utm_content=" + dw_content + "&utm_campaign=" + dw_campaign + "&redirect_uri=" + gcLink.substring(0,gcLink.indexOf("?"));
                }
                dojo.attr(item, "href", gcLink);
            }
        });
        dojo.forEach(dojo.query ("#ibm-content-main a"), function (item, index) {
            var bLink = dojo.attr(item, "href");
            if (bLink && (((bLink.indexOf("//www.bluemix.net") > -1) || (bLink.indexOf("//ace.ng.bluemix.net") > -1) || (bLink.indexOf("//www.ng.bluemix.net") > -1) || (bLink.indexOf("mybluemix.net") > -1) || ((bLink.indexOf("//hub.jazz.net") > -1) && ((bLink.indexOf("/git") == -1)||(bLink.indexOf("/project") == -1)))) && (bLink.indexOf("?") == -1))) { 
                if (bLink.indexOf("//hub.jazz.net") > -1) {
                    bLink = bLink + "?utm_source=" + dw_source + "&utm_campaign=" + dw_campaign + "&utm_content=" + dw_content + "&utm_medium=" + dw_medium;    
                    } else {
                        if (bLink.indexOf("/#/") == -1) {
                            if (bLink.substring(bLink.length-7) == "/docs/#") {
                                bLink = bLink.replace("/docs/#","/docs/" + "?cm_mmc=" + dw_source + "-_-" + dw_campaign + "-_-" + dw_content + "-_-" + dw_medium + "#");
                            } else {
                                bLink = bLink + "?cm_mmc=" + dw_source + "-_-" + dw_campaign + "-_-" + dw_content + "-_-" + dw_medium;
                            }
                        } else {
                            bLink = bLink.substring(0,bLink.indexOf("#")) + "?cm_mmc=" + dw_source + "-_-" + dw_campaign + "-_-" + dw_content + "-_-" + dw_medium + bLink.substring(bLink.indexOf("#")-1);
                        }
                    }
                dojo.attr(item, "href", bLink);
            }
        }); 
    });
</script><!-- LEADSPACE_STYLES -->

</head>

<body id="ibm-com">

	<div id="ibm-top" class="ibm-landing-page">

<!-- MASTHEAD_BEGIN -->
<div id="ibm-masthead">

    <!-- TOP ROW -->    
	<div id="dw-masthead-top-row">
		<ul id="ibm-mast-options-dw" role="toolbar" class="cn">
		<li role="presentation" id="dw-mast-top-4">
				<a href="http://www.ibm.com/developerworks/cn/"><img src="//dw1.s81c.com/developerworks/i/mf/dwn-dw-badge.png" width="43" height="22" alt="dW" aria-label="dW" /></a></li>
			<li role="presentation" id="dw-mast-top-0">
				<div><a class="dw-mf-noscript" href="#" title="登录（或注册）需启用 JavaScript" role="button" tabindex="0">登录 (或注册)</a></div>
			</li>
			<li role="presentation" id="dw-mast-top-1">
				<div><a href="#SELECTLANG" role="button">中文</a></div>
			</li>
			<li role="presentation" id="dw-mast-top-3">
				<a role="button" href="http://www.ibm.com">IBM</a>
			</li>
			<li role="presentation" id="dw-mast-top-2" class="dw-mf-hide">
				<a href="#">[userid]</a>
			</li>
		</ul>
	</div>

    <!-- TOP ROW SLIDER -->
	<div id="ibm-my-menu-dw" style="display:none">
        <!-- Sign-in -->
		<div id="signin_div" class="dw-mast-columns" role="group">
			<div class="dw-mast-col-1-1">
				<div id="dw-mast-sso">
					<div id="signin_error_mf" class="no-display"></div>
					<div id="dw-mast-sso-form">
						<form id="sForm_mf" action="" method="post" name="sForm_name_mf" onsubmit="return false;">
							<div id="dw-mast-sso-id" class="dw-mast-sso-id-cn">
								<label for="ibmid_mf">IBM ID:</label>
								<input id="ibmid_mf" value="" name="ibmid_name_mf" maxlength="100"
								    onkeypress="dwsi.siInst.handleEP(event,this.form,'mf');" type="text" />
							</div>
							<div id="dw-mast-sso-pw" class="dw-mast-sso-pw-cn">
								<label for="pw_mf">密码：</label>
								<input id="pw_mf" value="" name="pw_name_mf" maxlength="100"
								    onkeypress="dwsi.siInst.handleEP(event,this.form,'mf');" type="password" />
							</div>
							<div id="dw-mast-sso-target" class="dw-mast-sso-target-cn">
								<p class="dw-mf-perm-box">
									<input id="perm_mf" name="perm_name_mf" type="checkbox"><label for="perm_mf"> 保持登录。</label></input>
								</p>
							</div>					
							<div id="dw-mast-sso-terms">
								<p class="dw-mast-sso-terms-cn">单击提交则表示您同意developerWorks 的条款和条件。 <a
								    href="//www.ibm.com/developerworks/community/terms?lang=zh">查看条款和条件</a>.</p>
									</div>
							<div>
								<input class="dw-mf-submit-btn-cn" name="ibm_submit_name_mf" value="提交"
								    onclick="dwsi.siInst.signin('mf');return false;" type="submit" />
							</div>
						</form>
					</div>
					<div id="dw-mast-sso-update">
						<div id="dw-mast-sso-update-id">
							<ul>
								<li><a href="#" onclick="(function ()
								    {window.location='//www.ibm.com/developerworks/dwwi/DWAuthRouter?m=reg&amp;lang=zh_CN&amp;d='+encodeURIComponent(location.href);})();">需要一个 IBM ID？</a></li>
								<li><a href="//www.ibm.com/developerworks/dwwi/jsp/WSHelp.jsp?lang=zh_CN">忘记 IBM ID？</a></li>
							</ul>
						</div>
						<div id="dw-mast-sso-update-pw">
							<ul class="dw-mf-pwupdate">
								<li><a href="#" onclick="(function ()
								    {window.location='https://www.ibm.com/account/profile?page=forgot&amp;lang=zh_CN&amp;appname=ibm&amp;required=null&amp;d='+encodeURIComponent(dwsi.siInst.getAuthUrl())+'%3Fm%3Dloginpage%26lang%3Den_US%26d%3D'+encodeURIComponent(location.href);})();">忘记密码？</a></li>
								<li><a href="#" onclick="(function ()
								    {window.location='https://www.ibm.com/account/profile?page=chpw&amp;lang=zh_CN&amp;appname=ibm&amp;required=null&amp;d='+encodeURIComponent(location.href);})();">更改您的密码</a></li>
							</ul>
						</div>
					</div>
					<div id="dw-mast-sso-text">
						<p>在您首次登录 developerWorks 时，会为您创建一份个人概要。<strong>您的个人概要中的信息（您的姓名、国家/地区，以及公司名称）是公开显示的，而且会随着您发布的任何内容一起显示，除非您选择隐藏您的公司名称。</strong>您可以随时更新您的 IBM 帐户。</p>
						<p class="dw-mf-secure-cn">所有提交的信息确保安全。</p>
					</div>
				</div>
				<div id="dw-mast-dname" class="dw-mf-hide">
					<p>当您初次登录到 developerWorks 时，将会为您创建一份概要信息，您需要指定一个昵称。您的昵称将和您在 developerWorks 发布的内容显示在一起。</p><p><strong>昵称长度在 3 至 31 个字符之间</strong>。 您的昵称在 developerWorks 社区中必须是唯一的，并且出于隐私保护的原因，不能是您的电子邮件地址。</p>
					<div id="signin_dname_error_mf" class="no-display"></div>
					<div id="dw-mast-dname-form"  class="dw-mast-dname-form-cn">
						<form id="dForm_mf" action="" method="post" name="dForm_name_mf" onsubmit="return false;">
							<div id="dw-mast-dname-mf">
								<label for="dname_mf">昵称：</label>
								<input id="dname_mf" name="dname_name_mf" maxlength="31" size="25" value=""
								    onkeypress="dwsi.siInst.handleEP(event,this.form,'mf');" type="text" />
							</div>
							<div id="dw-mast-dname-terms">
								<p class="dw-mast-dname-terms-cn">单击<strong>提交</strong>则表示您同意developerWorks
								    的条款和条件。 <a href="//www.ibm.com/developerworks/community/terms?lang=zh">查看条款和条件</a>.</p>
									</div>
							<div>
								<input class="dw-mf-submit-btn-cn" name="dname_submit_name_mf" value="提交"
								    onclick="dwsi.siInst.signin('mf');return false;" type="submit" />
							</div>
						</form>								
					</div>
					<div id="dw-mast-dname-secure">
						<p class="dw-mf-secure-cn">所有提交的信息确保安全。</p>
					</div>
				</div>
				<div id="dw-mast-auth" class="dw-mf-hide">
					<div>
						<h2>developerWorks 社区:</h2>
                		<ul>
							<li><a id="dw-mast-top-0-0" href="//www.ibm.com/developerworks/community/homepage?lang=zh">我的首页</a></li>						    
							<li><a
							    href="//www.ibm.com/developerworks/community/profiles/html/myProfileView.do?lang=zh">我的概要信息</a></li>
							<li><a
							    href="//www.ibm.com/developerworks/community/groups/service/html/mycommunities?lang=zh">我的社区</a></li>
			                 <li><a href="/developerworks/community/news/?lang=zh">设置</a></li>
										    
						</ul>     
					</div>
					
					<div class="dw-mast-more">
						<ul class="ibm-link-list">
							<li><a class="dw-more-link" href="#" onclick="dwsi.siInst.signOut(); return false;"><strong>退出</strong></a></li>
						</ul>
					</div>
				</div>								
			</div>		
		</div>
        <!-- Language selector --> 
		<div id="lang_div" class="dw-mast-columns" role="group">
			<div class="dw-mast-col-2-1">
				<h2>选择语言：</h2>
				<ul>
					<li><a id="dw-mast-top-1-0" href="http://www.ibm.com/developerworks/" lang="en">English</a></li>
					<li><a href="http://www.ibm.com/developerworks/cn/">中文</a></li>
					<li><a href="http://www.ibm.com/developerworks/jp/" lang="ja">日本語</a></li>
					<li><a href="http://www.ibm.com/developerworks/ru/" lang="ru">Русский</a></li>
				</ul>
			</div>
			<div class="dw-mast-col-2-2">
				<ul>
					<li><a href="http://www.ibm.com/developerworks/br/" lang="pt">Português (Brasil)</a></li>
					<li><a href="http://www.ibm.com/developerworks/ssa/" lang="es">Español</a></li>
					<li><a href="http://www.ibm.com/developerworks/vn/" lang="vi">Việt</a></li>
				</ul>
			</div>
		</div>
		<div id="empty_div" class="dw-mast-columns" role="group"><!-- Authenticated --></div>		
		<!-- IBM -->
		<div id="ibmhome_div" class="dw-mast-columns" role="group">
			<div class="dw-mast-col-2-1">
				<ul>
					<li><a id="dw-mast-top-3-0" href="http://www.ibm.com/cn/zh/">IBM 主页</a></li>
					<li><a href="http://www.ibm.com/solutions/cn/zh/">解决方案</a></li>
					<li><a href="http://www.ibm.com/software/cn/">软件</a></li>
				</ul>
			</div>
			<div class="dw-mast-col-2-2 dw-mast-ibm">
				<ul>
							<li><a href="http://www.ibm.com/support/cn/zh/">支持门户</a></li>
							<li><a href="http://www.ibm.com/support/documentation/cn/zh/">产品文档</a></li>
							<li><a href="http://www.ibm.com/redbooks/">Redbooks（英文）</a></li>
				</ul>
			</div>	
		</div>		
	</div>
		
    <!-- BOTTOM ROW -->
	<div id="ibm-universal-nav-dw" aria-label="Site map">
		<ul id="ibm-unav-links-dw">
			<li id="ibm-unav-home-dwlogo">
				<a href="http://www.ibm.com/developerworks/cn/"><img src="//dw1.s81c.com/developerworks/i/mf/dwn-dw-wordmark.png" width="225" height="28" alt="developerWorks®" /></a>
			</li>
		</ul>
		<ul id="ibm-menu-links-dw" class="ibm-menu-links-dw-cn" role="toolbar" aria-label="Site map">
			<li id="dw-mast-nav-0" role="presentation"><a href="http://www.ibm.com/developerworks/cn/topics/" tabindex="0">技术主题</a></li>
			<li id="dw-mast-nav-1" role="presentation"><a href="http://www.ibm.com/developerworks/cn/downloads/">软件下载</a></li>
			<li id="dw-mast-nav-2" role="presentation"><a href="http://www.ibm.com/developerworks/community/?lang=zh">社区</a></li>
			<li id="dw-mast-nav-3" role="presentation"><a href="https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=6d7f9e5d-5f89-4767-a006-a81b8d186370&amp;lang=zh">技术讲座</a></li>
		</ul>
		<form id="ibm-search-form" action="//www.ibm.com/search/csass/search/" method="get" name="form1" aria-label="搜索 developerWorks" role="search">
			<p>
				<label for="q"><span class="ibm-access">搜索 developerWorks</span></label>
				<input id="q" type="text" name="q" value="搜索 developerWorks" maxlength="100"/>
				<input type="hidden" name="sn" value="dw" />
				<input type="hidden" name="lang" value="zh" />
				<input type="hidden" name="cc" value="CN" />
				<input type="hidden" name="en" value="utf" />
				<input type="hidden" name="hpp" value="20" />
				<input type="hidden" name="dws" value="cndw" />
				<input type="hidden" name="lo" value="zh" />
				<input id="ibm-search" class="ibm-btn-search" type="submit" value="提交" />
			</p>
		</form>
	</div>    
	
</div>
<div id="fdiv" class="ibm-access"></div><!-- MASTHEAD_END -->
	    
<!-- LAYOUT -->
<!-- LEADSPACE_BEGIN --> 
<div id="ibm-leadspace-head">
	<!-- LEADSPACE_BODY_BEGIN --> 
	<div id="ibm-leadspace-body">
		<!-- Navigation_Trail_BEGIN -->
      <ul id="ibm-navigation-trail"><li><a href="http://www.ibm.com/developerworks/cn/">developerWorks 中国</a></li><li><a href="http://www.ibm.com/developerworks/cn/topics/">技术主题</a></li><li><a href="http://www.ibm.com/developerworks/cn/linux/">Linux</a></li><li><a href="http://www.ibm.com/developerworks/cn/views/linux/libraryview.jsp">文档库</a></li></ul>
		<!-- END_Navigation_Trail -->
			<!-- Title_Subtitle -->
			<h1>侦测程序句柄泄露的统计方法</h1>
	</div>
	<!-- LEADSPACE_BODY_END --> 
	<!-- SUMMARY_BEGIN -->
	<div id="dw-summary-area" class="dw-summary-columns">
		<div class="ibm-col-6-4">
		<p>在 Linux 平台上运行的进程都会从系统资源申请一定数量的句柄，而且系统控制了进程能够申请的最大句柄数量。用户程序如果不及时释放无用的句柄，将会引起句柄泄露，从而可能造成申请资源失败。该文章从 linux 内核角度分析了句柄的产生和泄漏的原因，并采用一种应用统计侦测句柄的方法，为用户判断程序句柄是否泄漏提供了更直观的依据。</p>
		<p class="ibm-no-print ibm-ind-link">

			
			<span id="nCmts"></span>
		</p>
		</div>
		<div class="ibm-col-6-2 dw-toc-margin">
			<p class="dw-summary-author"><a href="#authorN1001D" class="ibm-popup-link" onclick="ibmweb.overlay.show('authorN1001D',this);return false;">梅 胜</a> (<a href="mailto:meisheng@cn.ibm.com?subject=侦测程序句柄泄露的统计方法">meisheng@cn.ibm.com</a>), 软件工程师, IBM</p>
<div id="authorN1001D" class="ibm-common-overlay"><div class="ibm-head"><p><a href="#close" class="ibm-common-overlay-close">关闭 [x]</a></p></div><div class="ibm-body"><div class="ibm-main"><div class="ibm-title"><!--this is where the h2 usually goes--></div><div class="ibm-container ibm-alternate"><div class="ibm-container-body">
<p><!--.-->
梅胜，2006年加入IBM 中国软件开发中心存储部门，目前从事存储软件功能测试工作。</p><br /><br /></div></div></div></div><div class="ibm-footer"><!----></div></div>
<p class="dw-summary-author"><a href="#authorN1002D" class="ibm-popup-link" onclick="ibmweb.overlay.show('authorN1002D',this);return false;">王 宁</a>, 软件工程师, IBM</p>
<div id="authorN1002D" class="ibm-common-overlay"><div class="ibm-head"><p><a href="#close" class="ibm-common-overlay-close">关闭 [x]</a></p></div><div class="ibm-body"><div class="ibm-main"><div class="ibm-title"><!--this is where the h2 usually goes--></div><div class="ibm-container ibm-alternate"><div class="ibm-container-body">
<p><!--.-->
王宁，IBM 中国系统与科技研发中心软件工程师，拥有五年以上工作经验，从事 CIM 功能测试两年以上，主要负责产品有 SVC，Tape 等。</p><br /><br /></div></div></div></div><div class="ibm-footer"><!----></div></div>
<p class="dw-summary-author"><a href="#authorN1003D" class="ibm-popup-link" onclick="ibmweb.overlay.show('authorN1003D',this);return false;">杨 承川</a> (<a href="mailto:ychengc@cn.ibm.com?subject=侦测程序句柄泄露的统计方法">ychengc@cn.ibm.com</a>), 软件工程师, IBM</p>
<div id="authorN1003D" class="ibm-common-overlay"><div class="ibm-head"><p><a href="#close" class="ibm-common-overlay-close">关闭 [x]</a></p></div><div class="ibm-body"><div class="ibm-main"><div class="ibm-title"><!--this is where the h2 usually goes--></div><div class="ibm-container ibm-alternate"><div class="ibm-container-body">
<p><!--.-->
杨承川，IBM 中国系统与技术实验室，软件测试工程师，2008 年获得东华大学计算机硕士学位并于 2008 年加入 IBM，目前主要从事 IBM 存储软件的测试。</p><br /><br /></div></div></div></div><div class="ibm-footer"><!----></div></div>
			<p class="dw-summary-date">2009 年 11 月 05 日</p>
			


			<div aria-hidden="true" class="ibm-container" id="dw-toc"><div class="ibm-container-body"><ul class="ibm-twisty"><li><a href="#toggle" class="ibm-twisty-trigger"><img src="//www.ibm.com/i/c.gif" alt="-"/></a><span class="ibm-twisty-head">内容</span><div class="ibm-twisty-body"><ul style="font-size:0.8em" class="ibm-link-list">
<li><a class="ibm-anchor-down-em-link" href="#1. 句柄介绍 |outline">句柄介绍</a></li>
<li><a class="ibm-anchor-down-em-link" href="#2. 句柄泄露 |outline">句柄泄露</a></li>
<li><a class="ibm-anchor-down-em-link" href="#3.Linux 检测句柄的方法 |outline">Linux 检测句柄的方法</a></li>
<li><a class="ibm-anchor-down-em-link" href="#4. 基于统计方法的侦测句柄泄露 |outline">基于统计方法的侦测句柄泄露</a></li>
<li><a class="ibm-anchor-down-em-link" href="#resources">参考资料 </a></li>
<li><a class="ibm-anchor-down-em-link" href="#icomments">评论</a></li></ul></div></li></ul></div></div>
		</div>
	</div>
	<!-- SUMMARY_END -->
</div>
<!-- LEADSPACE_END -->

<div id="ibm-pcon">

<!-- BEGIN_IBM-CONTENT -->
<div id="ibm-content">

<!-- BEGIN_IBM-CONTENT-BODY -->
<div id="ibm-content-body">

<!-- BEGIN_IBM-CONTENT-MAIN -->
<div id="ibm-content-main">

<!-- 1_1_COLUMN_BEGIN -->
<div class="ibm-columns">
<div class="ibm-col-1-1">

<h2 id="1. 句柄介绍 |outline">句柄介绍</h2><h3 id="N10059">句柄的介绍及应用</h3><p>句柄是在 Windows 中引入的一个概念，它是和对象一一对应的 32 位无符号整数值。句柄可以映射到唯一的对象，它是处理对象的一个接口，对于所涉及的对象，可以通过相应的句柄来操作它。句柄的引入主要是操作系统为了避免应用程序直接对某个对象的数据结构进行操作为目的，用操作句柄来代替操作对象。</p><p>在 Linux 环境中，任何事物都是用文件来表示，设备是文件，目录是文件，socket 也是文件。用来表示所处理对象的接口和唯一接口就是文件。应用程序在读 / 写一个文件时，首先需要打开这个文件，打开的过程其实质就是在进程与文件之间建立起连接，句柄的作用就是唯一标识此连接。此后对文件的读 / 写时，目标文件就由这个句柄作为代表。最后关闭文件其实就是释放这个句柄的过程，使得进程与文件之间的连接断开。</p><h3 id="N10062">句柄的产生和结构</h3><p>要了解 Linux 当中的句柄，必须先了解 Linux 的文件系统，下图表示了 Linux 的每个进程 (task) 的结构，及 task 所打开的文件的结构。</p><h5 id="N1006A">图 1. task_struct 的结构图</h5><img alt="图 1. task_struct 的结构图" src="images/image001.gif" width="581" /><p>以下主要列举 <code>task_struct, files_struct</code>的数据结构：</p><div class="codesection"><pre class="displaycode"> struct task_struct { 
	……
 /* filesystem information */ 
	 struct fs_struct *fs; 
	……
 /* open file information */ 
	 struct files_struct *files; 
	……
 /* limits */ 
	 struct rlimit rlim[RLIM_NLIMITS]; /* rlim[7] 表示 open file 的限制 / 
 } 

 struct files_struct { 
	……
 struct file ** fd; /* current fd array */ 
……
 struct files * fd_array[NR_OPEN_DEFAULT]; 
 }</pre></div><p><code>files_struct</code>数据结构中最主要的就是 file 结构指针数组 fd_array[]，这个数组的大小是固定的，即 32，其下标即为“打开文件号”。fd 最初指向 fd_array[]。一个进程可以打开多少个文件取决于该进程的 task_struct 结构中关于可用资源的限制 rlim[7]，在这个限制以内，如果超过了 file 结构指针数组的容量就可以通过 expand_fd_array() 来扩充该数组的容量，并让 fd 指向新的数组。</p><p>当前进程的进程控制块 (task_struct) 结构中有一个 file 指针，指向已打开的文件信息结构 files_struct。当进程通过打开文件 ( 如 open()) 与具体的文件建立起连接，实际上系统会查找一个空闲的 fid 作为 fd_array 的下标，将其指向一个 file 数据结构，返回给进程的就是 fid，这个 fid 就是句柄。</p><h3 id="N10083">系统对句柄的管理</h3><p>了解了句柄的产生，接下来我们来介绍 Linux 是如何对句柄进行管理。</p><p>用户通过 open() 来申请资源，在系统内核中实际会调用 sys_open() 方法来实现真正的资源申请工作。sys_open() 的代码在 fs/open.c 中：long sys_open(const char * filename, int flags, int mode) 。调用参数 filename 实际上是文件的路径名（绝对路径或者相对路径名）；mode 表示打开的模式，如只读等等；flag 则包含了许多标志位，可以表示打开模式以外的一些属性和要求。</p><p>sys_open 具体的操作过程如下：</p><h5 id="N1008F">图 2. sys_open 操作过程图</h5><img alt="图 2. sys_open 操作过程图" src="images/image002.gif" width="325" /><ol type="1"><li>
调用 getname() 从用户空间把文件的路径名拷贝到系统空间</li><li>
调用 get_unused_fd() 从进程的可使用的文件描述符中找出一个没有被使用的文件描述符（确切的说是文件描述符数组的下标）。</li><li>
调用 flip_open() 打开一个创建的文件，并返回一个文件描述符。</li></ol><p>用户向系统申请文件资源是否能够成功，主要取决于 get_unused_fd 函数。如果函数的返回值为大于 0 的正整数，则 sys_open 能够获得系统文件资源；如果函数的返回值为－1，说明申请失败，该进程所申请的文件数已经超过系统设置的最大值。get_unused_fd 具体的操作过程如下：</p><h5 id="N100A3">图 3. get_unused_fd 操作过程图</h5><img alt="图 3. get_unused_fd 操作过程图" src="images/image003.gif" width="503" /><ol type="1"><li>
调用 find_next_zero_bit，从进程描述符位图（fd）中找出一个没有被占用（置位）的位，得到它的下标。</li><li>
检验这个描述符下标的合法性，即是否满足资源限制。一个进程可以打开多少个文件取决于该进程的 task_struct 结构中关于可用资源的限制 rlim，在这个限制以内，如果超过了 file 结构指针数组的容量就可以通过 expand_fd_array() 来扩充该数组的容量，并让 fd 指向新的数组。</li><li>
若操作成功，返回这个下标。</li></ol><p>与打开文件的方式类似，Linux 系统调用 close() 函数关闭文件，并由内核中的 sys_close() 负责具体实现。sys_close() 函数也处于 fs/open.c 中：long sys_close(unsigned int fd) 。它的作用是释放进程已经占用的某一文件资源。调用参数 fd 为需要关闭的文件句柄值。</p><div class="ibm-alternate-rule"><hr/></div><p class="ibm-ind-link ibm-back-to-top"><a href="#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p><h2 id="2. 句柄泄露 |outline">句柄泄露</h2><h3 id="N100BB">句柄泄露</h3><p>造成句柄泄露的主要原因，是进程在调用系统文件之后，没有释放已经打开的文件句柄。在 Linux 系统中，进程与文件之间是通过“打开文件”操作建立连接，文件系统会返回文件句柄来唯一标识进程与文件的连接。每当一个进程执行完毕之后，Linux 系统会将与进程相关的文件句柄自动释放。但是，如果进程一直处于执行状态，文件的句柄只能通过“关闭文件”操作来自我释放。与 Windows 系统的设置不同，Linux 系统对进程可以调用的文件句柄数做了限制，在默认情况下，每个进程可以调用的最大句柄数为 1024 个。超过了这个数值，进程则无法获得新的句柄。因此，句柄的泄露将会对进程的功能失效造成极大的隐患。</p><h3 id="N100C2">如何修改系统最大句柄数</h3><p>Linux 中，单个进程能够打开的最大文件句柄数量是可以配置的，系统默认是 1024。当单个进程打开的文件句柄数量超过了系统定义的值，就会出现“Too many files open”的错误提示。用户可以通过以下命令查看系统定义的最大值：</p><div class="codesection"><pre class="displaycode"> ulimit – n</pre></div><p>对于一般的应用程序而言 1024 已经完全够用了，但是有些进程处理大量请求，很有可能 1024 就不够用了，则需要调整系统参数，来适应应用的变化。Linux 有硬性和软性设置两种，都可以通过 ulimit 来设置。例如</p><div class="codesection"><pre class="displaycode"> ulimit – HSn 2048</pre></div><p>以上命令就可以设置 H（硬性），S（软性）的值为 2048。设定完成后，一旦系统重启，就又恢复成默认值了。</p><h3 id="N100D5">句柄泄露的实例</h3><p>以下是一个能够造成文件句柄泄露的实例。</p><div class="codesection"><pre class="displaycode">＃ define Maximum 1024 
 Int i = 0; 
 while(i&lt; Maximum) 
 { 
 fh = open("/home/ychengc/filehandle.c",O_CREAT | 
 O_WRONLY ,S_IRUSR|S_IWU        SR); 
 printf("%d\n",fh); 
 i++; 
 }</pre></div><p>在这段程序中，进程连续 1024 次向系统申请文件 <code>/home/ychengc/filehandle.c</code>的句柄。理论上，每次都应该成功。但是，我们却发现 fh 的最小值是 3，最大值是 1023。当 fh 超过 1023 后，每次申请的句柄 ID 都是等于－1。造成这种情况的原因，是每个进程都会默认的保留 3 个文件描述符，文件描述符 0、1、2 分别代表标准输入、标准输出和标准错误输出。因此，这个进程一共向系统申请了 1027 个文件描述符，超过了系统最大值 1024 的限制，导致最后三次的申请都是失败的。</p><div class="ibm-alternate-rule"><hr/></div><p class="ibm-ind-link ibm-back-to-top"><a href="#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p><h2 id="3.Linux 检测句柄的方法 |outline">Linux 检测句柄的方法</h2><p>   在 Linux 平台上，lsof（list open files）是一个列出当前系统打开文件的工具。在 Linux 环境下，任何事物都以文件的形式存在，系统在后台为应用程序分配了一个文件描述符，无论这个文件的本质如何，该文件描述符为应用程序与基础操作系统之间的交互提供了通用接口。因为应用程序打开文件的描述符列表提供了大量关于这个应用程序本身的信息，因此通过 lsof 工具能够查看这个列表对系统监测以及排错将是很有帮助的。</p><p>在终端下输入 lsof 即可显示系统打开的文件，因为 lsof 需要访问核心内存和各种文件，所以必须以 root 用户的身份运行它才能够充分地发挥其功能。屏幕显示如下：</p><div class="codesection"><pre class="displaycode"> COMMAND     PID    USER   FD      TYPE     DEVICE      SIZE       NODE NAME 
 init          1    root  cwd       DIR        3,2      4096          2 / 
 init          1    root  rtd       DIR        3,2      4096          2 / 
 init          1    root  txt       REG        3,2     32684    1200637 /sbin/init 
……</pre></div><p>lsof 输出各列信息的意义如下：</p><p>COMMAND：进程的名称 <br />PID：进程标识符 <br />USER：进程所有者 <br />FD：文件描述符，应用程序通过文件描述符识别该文件。如 cwd、txt 等 <br />TYPE：文件类型，如 DIR、REG 等 <br />DEVICE：指定磁盘的名称 <br />SIZE：文件的大小 <br />NODE：索引节点（文件在磁盘上的标识）<br />NAME：打开文件的确切名称</p><p>在 Linux 系统中可以用 man lsof 查看详细的介绍和参数使用方法，在这里不作过多介绍。在侦测程序句柄泄露的应用中，我们主要用到 lsof 的如下使用方法：</p><div class="codesection"><pre class="displaycode"> lsof – p PID</pre></div><p>PID 是指我们要侦测程序的进程号，可以用命令 ps – ef 来得到。我们以进程号 14946 为例：</p><div class="codesection"><pre class="displaycode"> # lsof -p 14946 
 COMMAND     PID USER   FD   TYPE  DEVICE     SIZE   NODE NAME 
 rpc.rquot 14946 root  cwd    DIR     3,2     4096      2 / 
 rpc.rquot 14946 root  rtd    DIR     3,2     4096      2 / 
 rpc.rquot 14946 root txt REG 3,2 65292 267543 
 /usr/sbin/rpc.rquotad 
 rpc.rquot 14946 root mem REG 3,2 45889 535442 
 /lib/libnss_files-2.3.4.so 
 rpc.rquot 14946 root mem REG 3,2 1454802 541622 /lib/tls/ 
 libc-2.3.4.so 
……</pre></div><p>每一行就代表该进程正在使用的一个文件，即句柄。统计行数总和就是该进程打开的所有句柄数量，这为我们用统计方法侦测句柄泄露提供的依据。</p><div class="ibm-alternate-rule"><hr/></div><p class="ibm-ind-link ibm-back-to-top"><a href="#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p><h2 id="4. 基于统计方法的侦测句柄泄露 |outline">基于统计方法的侦测句柄泄露</h2><p>通过运行 lsof 工具我们可以得到一个程序打开的所有句柄数量。我们基于统计方法的侦测句柄泄露的基本思想就是：在该程序连续运行的相当长时间内，对它打开的所有句柄数量进行固定周期采样，再利用作图工具对采样数据绘图，通过图形我们基本可以判断该程序是否存在句柄泄露。在程序运行的同时，我们可以运行大量测试用例，尽可能的覆盖程序的所有功能。</p><p>下面脚本对某进程采样 3000 个数据，每 10 秒采样一次，依此数据绘制句柄统计趋势图。</p><div class="codesection"><pre class="displaycode"> #!/bin/sh 
 set -x 
 echo ""&gt;total_handler 

 psid=`ps -ef|grep $1|head -1|awk '{print $2}'` 
 count=0 
 while [ $count -lt 3000 ] 
 do 
  lsof -p $psid|wc -l &gt;&gt; total_handler 
  sleep 10 
  count=`expr $count + 1` 
 done</pre></div><p>根据我们项目的测试经验，通常统计出来的句柄图形如下列三种：</p><h3 id="N10123">平稳</h3><h5 id="N10129">图 4. 平稳图</h5><img alt="图 4. 平稳图" src="images/image004.gif" width="464" /><p>在程序运行当中，句柄被不断地打开关闭，因此统计图形呈现平稳的锯齿形。在程序运行后期，很多临时打开的句柄被逐渐关闭，总的句柄数量没有随着时间的推移而增加，因此该程序不存在句柄泄露。</p><h3 id="N10134">峰值稳定</h3><h5 id="N1013A">图 5. 峰值稳定图</h5><img alt="图 5. 峰值稳定图" src="images/image005.gif" width="482" /><p>在该程序运行初期，程序打开的句柄数量会随着时间的推移而逐步增加。但是当运行一段时间后，句柄数量会达到一个相对平稳的状态，大概 3500 左右。这个时候表明程序打开了很多临时句柄，但是句柄数量相对稳定，也不存在句柄泄露问题。</p><h3 id="N10145">递增</h3><h5 id="N1014B">图 6. 递增图</h5><img alt="图 6. 递增图" src="images/image006.gif" width="435" /><p>程序在运行当中，某一操作引起了程序打开句柄数量逐步增加，而且没有出现相对平稳的迹象，说明该程序可能存在句柄泄露，需要进一步分析是哪一部分的句柄存在泄漏，以及什么操作会引起程序句柄的泄露。</p><p>通过对程序句柄数量进行采样统计，并且绘制出相应的统计图形，能够以比较直观的方式判断在程序中是否存在句柄泄露。该方法基于程序要运行大量的测试用例，增加测试用例的覆盖率，尽可能多的用测试用例触发程序打开和关闭句柄的操作，这样才能发现潜在的句柄泄露 bug。对于如何能够快速的发现句柄泄露代码，我们将做进一步研究。</p><!--CMA ID: 444974--><!--Site ID: 10--><!--XSLT stylesheet used to transform this file: dw-document-html-7.0.xsl-->


</div>
</div>
<!-- 1_1_COLUMN_END -->

<!-- SPLIT_COLUMNS_BEGIN -->
<div class="ibm-columns">

<!-- 6_4_COLUMN_BEGIN -->
<div class="ibm-col-6-4">

<h2 id="resources" class="ibm-rule">参考资料 </h2><ul class="ibm-bullet-list"><li>
《 Linux 内核源代码情景分析》 毛德操 浙江大学出版社 2001 年 9 月</li><li> 在 <a href="http://www.ibm.com/developerworks/cn/linux/"> developerWorks Linux 专区</a> 寻找为 Linux 开发人员（包括 <a href="http://www.ibm.com/developerworks/cn/linux/newto/">Linux 新手入门</a>）准备的更多参考资料，查阅我们 <a href="http://www.ibm.com/developerworks/cn/linux/top10/index.html">最受欢迎的文章和教程</a>。 </li><li>在 developerWorks 上查阅所有 <a href="http://www.ibm.com/developerworks/cn/views/linux/libraryview.jsp?search_by=Linux+%E6%8A%80%E5%B7%A7"> Linux 技巧</a> 和 <a href="http://www.ibm.com/developerworks/cn/views/linux/libraryview.jsp?type_by=%E6%95%99%E7%A8%8B"> Linux 教程</a>。 </li></ul>

<!-- INLINE_COMMENTS_BEGIN -->
<h2 id="icomments" class="ibm-alternate-rule ibm-no-print">条评论</h2>
    
<div class="ibm-no-print" id="dw-icomments-container">	
	<div id="threadShow"></div>
</div>
<!-- Sign in OVERLAY STARTS HERE -->
    
<!-- Sign in OVERLAY STARTS HERE -->
<div class="ibm-common-overlay" id="signin_overlay">
<div class="ibm-head">
<p><a class="ibm-common-overlay-close" href="#" onclick="dwsi.siInst.clearForm();">关闭 [x]</a></p>
</div>
<div class="ibm-body">
<div class="ibm-main">

 <div class="ibm-title">
<h2>developerWorks: 登录</h2>
<div id="ibm-overlay-error-signin" class="no-display"></div>
</div>
<div class="ibm-container ibm-alternate ibm-buttons-last">
<div class="ibm-container-body">
<p class="ibm-overlay-intro">标有星（<span class="ibm-required">*</span>）号的字段是必填字段。</p> 
<form class="ibm-column-form" id="sFormId" action="" method="post" name="sForm" onsubmit="return false;">
<p><label for="ibmid">IBM ID:<span class="ibm-required">*</span></label><span>
    <input name="ibm-id" id="ibmid" size="25" value="" class="required" type="text" onkeypress="dwsi.siInst.handleEP(event,this.form);" />
    <br /><a onclick="window.location='/developerworks/dwwi/DWAuthRouter?m=reg&amp;lang=zh_CN&amp;d='+encodeURIComponent(location.protocol + '//' + location.hostname + location.pathname + '#icomments'); return false;" href="#" class="ibm-forward-link">需要一个 IBM ID？</a> <br />
    <a class="ibm-forward-link" href="/developerworks/dwwi/jsp/WSHelp.jsp?lang=zh_CN">忘记 IBM ID？</a> 
</span>
</p> 
<p><label for="password">密码：<span class="ibm-required">*</span></label><span>
    <input name="password" id="password" size="25" value="" class="required" type="password" onkeypress="dwsi.siInst.handleEP(event,this.form);" />
    <br /><a class="ibm-forward-link" href="#" onclick="(function ()
        {window.location='https://www.ibm.com/account/profile?page=forgot&amp;lang=zh_CN&amp;appname=ibm&amp;required=null&amp;d='+encodeURIComponent(dwsi.siInst.getAuthUrl())+'%3Fm%3Dloginpage%26lang%3Dzh_CN%26d%3D'+encodeURIComponent(location.href);})();">忘记密码？</a>
    <br /><a class="ibm-forward-link" href="#" onclick="(function () {window.location='https://www.ibm.com/account/profile?page=chpw&amp;lang=zh_CN&amp;appname=ibm&amp;required=null&amp;d='+encodeURIComponent(location.href);})();">更改您的密码</a></span></p> 
<p class="dw-perm-box">
	<span><input id="perm" type="checkbox" name="perm_name"/><label for="perm"> 保持登录。</label></span>
</p>
<p>单击提交则表示您同意developerWorks 的条款和条件。 <a
    href="/developerworks/community/terms?lang=zh">查看条款和条件</a>。</p>
<div class="ibm-buttons-row">
   <p><input class="ibm-btn-arrow-pri" name="ibm-submit" value="提交" onclick="dwsi.siInst.signin();return false;" type="submit" /><span class="ibm-sep">&nbsp;</span>
<input value="取消" type="button" name="ibm-cancel" class="ibm-btn-cancel-sec" onclick="dwsi.siInst.clearForm();ibmweb.overlay.hide('signin_overlay');return false;"/></p>
</div>
</form>
 <div class="ibm-overlay-rule"><hr /></div> 

<p>在您首次登录 developerWorks 时，会为您创建一份个人概要。<strong>您的个人概要中的信息（您的姓名、国家/地区，以及公司名称）是公开显示的，而且会随着您发布的任何内容一起显示，除非您选择隐藏您的公司名称。</strong>您可以随时更新您的 IBM 帐户。</p>
<div><p class="dw-c-overlay-secure">所有提交的信息确保安全。</p></div>
</div>
</div>
</div>
</div>
<div class="ibm-footer"></div>
</div>
<!-- Display name OVERLAY STARTS HERE -->
<div class="ibm-common-overlay" id="displayname_overlay">
<div class="ibm-head">
<p><a class="ibm-common-overlay-close" href="#" onclick="dwsi.siInst.clearForm();">关闭 [x]</a></p>
</div>
<div class="ibm-body">
<div class="ibm-main">
<div class="ibm-title">
<h2>选择您的昵称</h2><br /><br />
<div id="ibm-overlay-error-dname" class="no-display"></div>
</div>
<div class="ibm-container ibm-alternate ibm-buttons-last">
<div class="ibm-container-body">
<p class="ibm-overlay-intro">当您初次登录到 developerWorks 时，将会为您创建一份概要信息，您需要指定一个昵称。您的昵称将和您在 developerWorks 发布的内容显示在一起。</p><p><strong>昵称长度在 3 至 31 个字符之间</strong>。 
    您的昵称在 developerWorks 社区中必须是唯一的，并且出于隐私保护的原因，不能是您的电子邮件地址。</p>
<p class="ibm-overlay-intro">标有星（<span class="ibm-required">*</span>）号的字段是必填字段。</p> 
<form id="dFormId" method="post" action="" name="dForm" onsubmit="return false;" class="ibm-column-form">
<p><label for="displayname">昵称：<span class="ibm-required">*</span></label><span>
    <input name="displayname" id="displayname" size="25" value="" type="text" onkeypress="dwsi.siInst.handleEP(event,this.form);" /></span>
    <span class="ibm-form-note">(昵称长度在 3 至 31 个字符之间)</span>
</p>
<p>单击<strong>提交</strong>则表示您同意developerWorks 的条款和条件。 <a href="/developerworks/community/terms?lang=zh">查看条款和条件</a>.</p>
<div class="ibm-buttons-row">
   <p><input class="ibm-btn-arrow-pri" name="ibm-submit" value="提交" onclick="dwsi.siInst.signin();return false;" type="submit" /><span class="ibm-sep">&nbsp;</span>
<input value="取消" type="button" name="ibm-cancel" class="ibm-btn-cancel-sec" onclick="dwsi.siInst.clearForm();ibmweb.overlay.hide('displayname_overlay');return false;" /></p>
</div>
</form>
<div class="ibm-overlay-rule"><hr /></div>
<div><p class="dw-c-overlay-secure">所有提交的信息确保安全。</p></div>
</div>
</div>
</div>
</div>
<div class="ibm-footer"></div>
</div>


<!-- INLINE_COMMENTS_END -->

</div>
<!-- 6_4_COLUMN_END -->

<!-- 6_2_COLUMN_BEGIN -->
<div class="ibm-col-6-2">

<!-- Next_Steps -->
<!-- Dig_Deeper -->


<!-- Promotion_Module -->
    
<!-- PROMOTION_MODULE_START -->
<div class="ibm-alternate-rule"><hr /></div>
<ul class="ibm-portrait-module-list">
<li><img height="60" width="60" src="//www.ibm.com/developerworks/i/sm-f-cl-puresystems70.jpg" alt=""/>
<h3><a class="ibm-feature-link"
    href="http://www.ibm.com/developerworks/cn/puresystems/">IBM PureSystems</a></h3>
<p>IBM PureSystems™ 系列解决方案是一个专家集成系统</p></li>
<li><img height="60" width="60" src="//www.ibm.com/developerworks/i/sm-f-knowledgepath50.jpg" alt=""/>
<h3><a class="ibm-feature-link" href="http://www.ibm.com/developerworks/cn/views/global/libraryview.jsp?type_by=Knowledge+paths">developerWorks 学习路线图</a></h3>
<p>通过学习路线图系统掌握软件开发技能</p></li>
<li><img height="60" width="60" src="//www.ibm.com/developerworks/i/sm-f-evaluationsoftware60.png" alt=""/>
<h3><a class="ibm-feature-link" href="http://www.ibm.com/developerworks/cn/downloads/">软件下载资源中心</a></h3>
<p>软件下载、试用版及云计算</p></li>
</ul>
<!-- PROMOTION_MODULE_END -->

</div>
<!-- 6_2_COLUMN_END -->

</div>
<!-- SPLIT_COLUMNS_END -->

<!-- BOTTOM_BACK_TO_TOP -->
<div class="ibm-columns">
<div class="ibm-col-1-1">
	<div class="ibm-alternate-rule"><hr/></div><p class="ibm-ind-link ibm-back-to-top"><a href="#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p>
</div>
</div>

<!-- Rating_Meta_BEGIN -->
<!--Rating_Meta_BEGIN--><div class="metavalue">static.content.url=http://www.ibm.com/developerworks/js/artrating/</div><div class="metavalue">SITE_ID=10</div><div class="metavalue">Zone=Linux</div><div class="metavalue">ArticleID=444974</div><div class="metavalue">ArticleTitle=侦测程序句柄泄露的统计方法</div><div class="metavalue">publish-date=11052009</div><script language="javascript" type="text/javascript">document.write('<div class="metavalue">url='+location.href.replace(/</g,  '%3C')+'</div>');</script><!--Rating_Meta_END-->
<!-- Rating_Meta_END -->

</div>
<!-- END_IBM_CONTENT_MAIN -->

</div>
<!-- END_IBM_CONTENT_BODY -->

</div>
<!-- END_IBM_CONTENT -->

</div>
<!-- END_IBM_PCON -->
<!-- FOOTER_BEGIN -->
<!-- FOOTER_BEGIN -->
<div id="ibm-footer"><!-- IBM footer container; disabled --></div>

<div id="ibm-footer-module-dwwrapper" role="contentinfo" aria-label="developerWorks Footer">

<div id="ibm-footer-module-dw">
	<div class="dw-footer-columns">
		<div class="dw-footer-col-5-1">
			<ul>
                <li><a href="https://www.ibm.com/developerworks/secure/feedback.jsp?domain=dwchina">帮助</a></li>
				<li><a href="http://www.ibm.com/developerworks/cn/author/">联系编辑</a></li>
				<li><a href="https://www.ibm.com/developerworks/secure/myideas2.jsp?domain=dwchina&start=true">提交内容</a></li>
				<li><a href="http://www.ibm.com/developerworks/cn/rss/">订阅源</a></li>
			</ul>
        </div>
		<div class="dw-footer-col-5-2">
			<ul>
			<li><a href="http://www.ibm.com/vrm/newsletter/10104?S_TACT=105AGX52&S_CMP=dwcntop">在线浏览每周时事通讯</a></li>
				<li><a class="dwcn-sina-link" href="http://weibo.com/ibmdw/" target="_blank">新浪微博</a></li>
				<li><a href="https://www.ibm.com/developerworks/community/report?lang=zh">报告滥用</a></li>
				<li><a href="https://www.ibm.com/developerworks/community/terms?lang=zh">使用条款</a></li>
				<li><a href="https://www.ibm.com/developerworks/cn/community/terms/thirdparty/">第三方提示</a></li>
			</ul>
		</div>
		<div class="dw-footer-col-5-3">
			<ul>
				<li><a href="http://www.ibm.com/privacy/cn/zh/">隐私条约</a></li>
				<li><a href="http://www.ibm.com/ibm/accessibility/cn/">浏览辅助</a></li>
				<li><a href="http://www.ibm.com/developerworks/cn/academic/">IBM 教育学院教育培养计划</a></li><li><a href="http://www.ibm.com/developerworks/cn/gep/">IBM 创业企业全球扶持计划</a></li><li><a href="http://www.ibm.com/partnerworld/isv/">ISV 资源 (英语)</a></li>
			</ul>
		</div>
		<div class="dw-footer-col-5-4">
		
 
			<ul>
				<li><a href="//www.ibm.com/developerworks/cn/newsletter/">dW 中国每周时事通讯</a><br /> 
				
				</li>
			</ul>
			</form>
		</div>
		<div class="dw-footer-col-5-5">
			<img width="223" height="46" alt="IBM®" src="//dw1.s81c.com/developerworks/i/mf/dwn-ibm-logo-v17.png">
			<img class="dw-preload" src="//1.www.s81c.com/i/v17/icons/ibm_sprite_social_blue_ON.png" alt="" width="1" height="1"/>
		</div>
	</div>
	<!-- Language selector no-script -->
	<noscript>
	<div id="dw-footer-selectlang">
		<h2><a name="SELECTLANG">选择语言：</a></h2>
		<ul>
			<li><a href="http://www.ibm.com/developerworks/" lang="en">English</a></li>
			<li><a href="http://www.ibm.com/developerworks/cn/">中文</a></li>
			<li><a href="http://www.ibm.com/developerworks/jp/" lang="ja">日本語</a></li>
			<li><a href="http://www.ibm.com/developerworks/ru/" lang="ru">Русский</a></li>
			<li><a href="http://www.ibm.com/developerworks/br/" lang="pt">Português (Brasil)</a></li>
			<li><a href="http://www.ibm.com/developerworks/ssa/" lang="es">Español</a></li>
			<li><a href="http://www.ibm.com/developerworks/vn/" lang="vi">Việt</a></li>
		</ul>
	</div>
	</noscript>
</div>

</div><!-- FOOTER_END --><!-- FOOTER_END -->

<!-- END_IBM-TOP -->
</div>

<!-- SCRIPTS_INCLUDE_BEGIN -->
<script type="text/javascript" src="/developerworks/js/v17/dw-comments.js">//</script>
<script type="text/javascript" language="JavaScript">
		dojo.ready(function(){
		rBHash = null;
		rBHash = new Object();
		rBHash['viperLang'] = 'zh';
		rBHash['urlLang'] = 'cn';
		
		dwsi.siInst = new dwweb.dynnav.dwsi();
		dwsi.siInst.initSI();		

		// construct the comment widget
dwc.cmts = '条评论';
dwc.signInPreText = '请';
dwc.signIn = '登录';
dwc.or = '或';
dwc.register = '注册';
dwc.signInPostText = '';
dwc.leaveCmt = '后发表评论。';
dwc.view = '查看';
dwc.totalCmts = '共有评论';
dwc.postYourCmt = '添加您的评论';
dwc.show = '显示：';
dwc.recentCmts = '最新评论';
dwc.allCmts = '所有评论';
dwc.tooLongCmt = '您的评论超过了 1000 字符限制';
dwc.numCharsLeft = '剩余 <span id="charCount">{1}</span> 字符';
dwc.reportAbuse = '报告滥用';
dwc.notifyMsg = '有新评论时提醒我';
dwc.htmlWarning = '注意：评论中不支持 HTML 语法'; 
dwc.cmt = '评论：';
dwc.addCmts = '添加评论';
dwc.addCmt = '添加评论';
dwc.doNotErase = '--在下方添加评论--'; 
dwc.viewOrAddCmts = '查看或添加评论';
dwc.reportInapprCont = '举报不良信息';
dwc.reportInapprContLink = 'http://www.ibm.com/developerworks/forums/forum.jspa?forumID=1834';
dwc.postingCmt = '正在发布评论……';
dwc.noCmt = '快来添加第一条评论';
dwc.netwkErr = '在检索评论时出错，请稍后刷新。';
dwc.addACmt = '添加评论';
dwc.instructCmt = '标有星号（<span class="ibm-required">*</span>）的是必填项目。';
dwc.btnPost = '发布';
dwc.btnPostAnon = '匿名发布';
dwc.btnClrCmt = '清除评论';
dwc.btnCancel = '取消';
dwc.showRecent = '显示最新的 {1} 条评论'; // {1} is the count to be substituted
dwc.showNext = '显示后 {1} 条评论'; // {1} is the count to be substituted
dwc.showAllCmts = '显示所有评论';
dwc.enterCmt = '请输入评论内容。';
dwc.loginErr = '暂时无法验证您的登录状态，请稍后再试。';
dwc.postErr = '暂时无法发布您的评论，请稍后再试。';
dwc.postBy = '由 <strong>{1}</strong>  于 {2} '; // {1} is the author to be substituted; {2} is the date
dwc.siteId = 10;
dwc.lang = 'zh_CN';
dwc.viperLang = 'zh';
//dwc.abuseHref =  null;
dwc.maxChars = 1000;
dwc.cmtTxt =  '评论：';
dwc.cmtsTxt =  '评论：';  
		dwc && new dwc.comments('threadShow','95%',5,'nCmts','icomments');
		});
</script>

<!-- BEGIN: Use this section to set page specific variables for the Unica Page Tag -->
<script language="JavaScript">var NTPT_PGEXTRA="ibmSkillLevel=1&ibmCmaId=444974&ibmContentAreas=linux";</script>
<!--END --><!-- SCRIPTS_INCLUDE_END -->

<div id="ibm-metrics">
<script src="//dw1.s81c.com/common/stats/stats.js" type="text/javascript">//</script>
</div>

</body>
</html>




















